# Test configuration for e2e tests with LocalStack
# This configuration tells Lumina to query the test accounts in LocalStack

defaultRegion: us-east-1
logLevel: debug

awsAccounts:
  - accountId: "000000000000"
    name: "test-production"
    assumeRoleArn: "arn:aws:iam::000000000000:role/lumina/LuminaTestRole"
    region: "us-east-1"

  - accountId: "111111111111"
    name: "test-staging"
    assumeRoleArn: "arn:aws:iam::111111111111:role/lumina/LuminaStagingRole"
    region: "us-east-1"

# Test data for E2E tests
# LocalStack's free tier doesn't support Savings Plans API or Pricing API, so we inject test data
testData:
  savingsPlans:
    # Test data for test-production account
    "000000000000":
      - savingsPlanArn: "arn:aws:savingsplans::000000000000:savingsplan/12345678-1234-1234-1234-123456789012"
        savingsPlanType: "Compute"
        state: "active"
        commitment: 10.0  # $10/hour
        start: "2024-01-01T00:00:00Z"
        end: "2027-01-01T00:00:00Z"

      - savingsPlanArn: "arn:aws:savingsplans::000000000000:savingsplan/87654321-4321-4321-4321-210987654321"
        savingsPlanType: "EC2Instance"
        state: "active"
        commitment: 5.0  # $5/hour
        region: "us-east-1"
        instanceFamily: "m5"
        start: "2024-06-01T00:00:00Z"
        end: "2027-06-01T00:00:00Z"

    # Test data for test-staging account
    "111111111111":
      - savingsPlanArn: "arn:aws:savingsplans::111111111111:savingsplan/11111111-2222-3333-4444-555555555555"
        savingsPlanType: "Compute"
        state: "active"
        commitment: 3.0  # $3/hour
        start: "2024-03-01T00:00:00Z"
        end: "2027-03-01T00:00:00Z"

  # Savings Plan Rates test data
  # LocalStack's free tier doesn't support DescribeSavingsPlanRates API (returns 501)
  # This provides mock rates for the Savings Plans defined above
  # Key format: "savingsPlanId" -> list of rates
  savingsPlanRates:
    # Rates for Compute SP (12345678-1234-1234-1234-123456789012)
    "12345678-1234-1234-1234-123456789012":
      - rate: 0.0537
        currency: "USD"
        unit: "Hrs"
        productType: "Linux/UNIX"
        serviceCode: "AmazonEC2"
        usageType: "BoxUsage:m5.xlarge"
        operation: "RunInstances"
        instanceType: "m5.xlarge"
        region: "us-east-1"
        tenancy: "shared"
      - rate: 0.0420
        currency: "USD"
        unit: "Hrs"
        productType: "Linux/UNIX"
        serviceCode: "AmazonEC2"
        usageType: "BoxUsage:c5.large"
        operation: "RunInstances"
        instanceType: "c5.large"
        region: "us-east-1"
        tenancy: "shared"

    # Rates for EC2 Instance SP - m5 family (87654321-4321-4321-4321-210987654321)
    "87654321-4321-4321-4321-210987654321":
      - rate: 0.0480
        currency: "USD"
        unit: "Hrs"
        productType: "Linux/UNIX"
        serviceCode: "AmazonEC2"
        usageType: "BoxUsage:m5.xlarge"
        operation: "RunInstances"
        instanceType: "m5.xlarge"
        region: "us-east-1"
        tenancy: "shared"

    # Rates for Compute SP in staging (11111111-2222-3333-4444-555555555555)
    "11111111-2222-3333-4444-555555555555":
      - rate: 0.0400
        currency: "USD"
        unit: "Hrs"
        productType: "Linux/UNIX"
        serviceCode: "AmazonEC2"
        usageType: "BoxUsage:c5.large"
        operation: "RunInstances"
        instanceType: "c5.large"
        region: "us-east-1"
        tenancy: "shared"

  # Pricing test data
  # LocalStack's free tier doesn't support the Pricing API, so we provide mock pricing
  # Flat map with keys in format "region:instanceType:operatingSystem" -> price
  # NOTE: We use a flat structure because Viper's mapstructure treats periods (.)
  # as nested delimiters, which breaks instance type names like "m5.xlarge"
  # IMPORTANT: Viper lowercases all map keys, so we must use lowercase OS names
  # Values match the instances created in testdata/ec2.json
  pricing:
    "us-east-1:m5.xlarge:linux": 0.192
    "us-east-1:c5.large:linux": 0.085
    "us-east-1:m5.large:linux": 0.096
